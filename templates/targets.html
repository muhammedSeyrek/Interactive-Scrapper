<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DarkWatch - Targets</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root { --bg-dark: #12141c; --bg-panel: #1b1e2b; --text-main: #e0e6ed; --text-muted: #8c9cad; --accent-blue: #0f62fe; --border: #393939; --high: #fa4d56; --low: #42be65; --warn: #f1c21b; }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'IBM Plex Mono', monospace; background: var(--bg-dark); color: var(--text-main); display: flex; height: 100vh; overflow: hidden; font-size: 13px; }
        
        .sidebar { width: 240px; background: #0b0d12; border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; }
        .brand { font-size: 16px; font-weight: 600; margin-bottom: 40px; letter-spacing: 1px; } .brand span { color: var(--accent-blue); }
        
        /* Menü Grubu için yeni sınıf */
        .nav-group { display: flex; gap: 10px; flex-direction: column; width: 100%; }
        /* Sidebar dikeyken menü linkleri */
        .sidebar .nav-group .menu-item { border-left: 3px solid transparent; border-bottom: none; }
        
        .menu-item { padding: 12px 15px; margin-bottom: 5px; color: var(--text-muted); text-decoration: none; display: block; }
        .menu-item:hover, .menu-item.active { background: rgba(255,255,255,0.05); color: #fff; border-left-color: var(--accent-blue); }
        .logout { margin-top: auto; color: var(--high); }

        .main-content { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; gap: 20px; }
        
        /* Header Responsive */
        .header { display: flex; justify-content: space-between; align-items: flex-end; border-bottom: 1px solid var(--border); padding-bottom: 15px; margin-bottom: 10px; flex-wrap: wrap; gap: 10px; }
        h2 { margin: 0; font-weight: 500; font-size: 22px; }

        .panel { background: var(--bg-panel); border: 1px solid var(--border); padding: 20px; }
        
        .add-form { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        input[type="text"] { flex: 1; background: #000; border: 1px solid var(--border); color: #fff; padding: 10px; font-family: inherit; min-width: 200px; }
        input:focus { outline: 1px solid var(--accent-blue); }
        .btn { background: var(--accent-blue); color: #fff; border: none; padding: 0 20px; cursor: pointer; font-weight: 600; transition: 0.2s; height: 38px; }
        .btn:hover { opacity: 0.9; }

        .table-responsive { overflow-x: auto; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid var(--border); }
        th { background: rgba(255,255,255,0.03); color: var(--text-muted); font-size: 11px; }
        
        .status-dot { height: 8px; width: 8px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .online { background-color: var(--low); box-shadow: 0 0 5px var(--low); }
        .offline { background-color: var(--high); }
        .scanning { background-color: var(--warn); animation: pulse 1s infinite; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        .btn-sm { background: transparent; border: 1px solid var(--accent-blue); color: var(--accent-blue); padding: 5px 10px; cursor: pointer; font-size: 11px; margin-left: 5px; white-space: nowrap; }
        .btn-sm:hover { background: var(--accent-blue); color: white; }
        .btn-del { border-color: var(--high); color: var(--high); }
        .btn-del:hover { background: var(--high); }

        /* --- MOBİL DÜZENLEMELERİ --- */
        @media (max-width: 900px) {
            body { flex-direction: column; height: auto; overflow: auto; }
            
            /* Sidebar'ı dikey yığın (column) yapıp ortalıyoruz */
            .sidebar { 
                width: 100%; 
                height: auto; 
                flex-direction: column; 
                align-items: center; 
                padding: 15px; 
            }
            
            .brand { margin-bottom: 15px; margin-right: 0; }
            
            /* Menü linklerini yan yana diz ama sığmazsa aşağı at (wrap) */
            .nav-group { 
                flex-direction: row; 
                flex-wrap: wrap; 
                justify-content: center; 
                width: 100%; 
                gap: 5px;
            }
            
            /* Mobilde menü linkleri alt çizgiyle aktif olsun */
            .sidebar .nav-group .menu-item { 
                border-left: none; 
                border-bottom: 2px solid transparent; 
                padding: 8px 12px;
                font-size: 12px;
            }
            .sidebar .nav-group .menu-item.active { 
                border-bottom-color: var(--accent-blue); 
                background: transparent; 
            }
            
            .logout { margin-top: 15px; }
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="brand"><span>//</span> DARK_WATCH</div>
        
        <div class="nav-group">
            <a href="/" class="menu-item">DASHBOARD</a>
            <a href="/targets" class="menu-item active">TARGETS</a>
            <a href="/graph" class="menu-item">LINK ANALYSIS</a>
        </div>

        <a href="/logout" class="menu-item logout">LOGOUT</a>
    </div>

    <div class="main-content">
        <div class="header">
            <div>
                <div style="font-size: 11px; color: var(--text-muted);">ASSET MANAGEMENT</div>
                <h2>TARGET CONFIGURATION</h2>
            </div>
            <div style="color: var(--low); font-weight: 600;">● OPERATIONAL</div>
        </div>

        <div class="panel">
            <form action="/add-target" method="POST" class="add-form">
                <input type="text" name="url" placeholder="Add .onion URL..." required>
                <button type="submit" class="btn">ADD TARGET</button>
            </form>

            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>TARGET URL</th>
                            <th>STATUS</th>
                            <th>SOURCE</th>
                            <th>LAST SCAN</th>
                            <th style="text-align: right;">ACTIONS</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{ range .Targets }}
                        <tr>
                            <td style="color: var(--text-muted);">{{ .ID }}</td>
                            <td style="font-family: monospace;">{{ .URL }}</td>
                            <td>
                                {{ if eq .LastStatus "Online" }}
                                    <span style="color: var(--low);"><span class="status-dot online"></span>Online</span>
                                {{ else if eq .LastStatus "Failed" }}
                                    <span style="color: var(--high);"><span class="status-dot offline"></span>Offline</span>
                                {{ else if eq .LastStatus "Scanning..." }}
                                    <span style="color: var(--warn);"><span class="status-dot scanning"></span>Scanning...</span>
                                {{ else }}
                                    <span style="color: var(--text-muted);">{{ .LastStatus }}</span>
                                {{ end }}
                            </td>
                            <td><span style="background: rgba(255,255,255,0.1); padding: 2px 6px; font-size: 10px;">{{ .Source }}</span></td>
                            <td>{{ .LastScannedAt.Format "01-02 15:04" }}</td>
                            <td style="text-align: right;">
                                <div style="display: flex; justify-content: flex-end; gap: 2px;">
                                    <form action="/scan-now" method="POST" style="margin:0;">
                                        <input type="hidden" name="id" value="{{ .ID }}">
                                        <button type="submit" class="btn-sm">SCAN</button>
                                    </form>

                                    <form action="/deep-scan" method="POST" style="margin:0;">
                                        <input type="hidden" name="id" value="{{ .ID }}">
                                        <button type="submit" class="btn-sm" style="border-color: #f1c21b; color: #f1c21b;">DEEP</button>
                                    </form>

                                    <form action="/delete-target" method="POST" style="margin:0;">
                                        <input type="hidden" name="id" value="{{ .ID }}">
                                        <button type="submit" class="btn-sm btn-del">DEL</button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {{ else }}
                        <tr><td colspan="6" style="text-align: center; color: var(--text-muted);">No targets configured.</td></tr>
                        {{ end }}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
</html>